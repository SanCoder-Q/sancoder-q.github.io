---
layout: post
title: SICP Exercise Results
---

<div id="outline-container-orgheadline41" class="outline-2">
<h2 id="orgheadline41"><span class="section-number-2">1</span> 1. Building Abstractions with Procedures</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-orgheadline1" class="outline-3">
<h3 id="orgheadline1"><span class="section-number-3">1.1</span> Exercise 1.1</h3>
<div class="outline-text-3" id="text-1-1">
<div class="org-src-container">

<pre class="src src-scheme">(list 10
      (+ 5 3 4)
      (- 9 1)
      (/ 6 2)
      (+ (* 2 4) (- 4 6))
      )
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">a</span> 3)
(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">b</span> (+ a 1))
(list (+ a b (* a b))
      (= a b)
      (<span style="color: #d1f1a9;">if</span> (<span style="color: #d1f1a9;">and</span> (&gt; b a) (&lt; b (* a b)))
          b
          a)
      (<span style="color: #d1f1a9;">cond</span> ((= a 4) 6)
            ((= b 4) (+ 6 7 a))
            (<span style="color: #d1f1a9;">else</span> 25))
      (+ 2 (<span style="color: #d1f1a9;">if</span> (&gt; b a) b a))
      (* (<span style="color: #d1f1a9;">cond</span> ((&gt; a b) a)
               ((&lt; a b) b)
               (<span style="color: #d1f1a9;">else</span> -1))
         (+ a 1)))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline2" class="outline-3">
<h3 id="orgheadline2"><span class="section-number-3">1.2</span> Exercise 1.2</h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">

<pre class="src src-scheme">(/ (+ 5 4 (- 2 (- 3 (+ 6 (/ 4 5)))))
   (* 3 (- 6 2) (- 2 7)))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline3" class="outline-3">
<h3 id="orgheadline3"><span class="section-number-3">1.3</span> Exercise 1.3</h3>
<div class="outline-text-3" id="text-1-3">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">func</span> a b c)
  (<span style="color: #d1f1a9;">if</span> (&gt; a b)
      (<span style="color: #d1f1a9;">if</span> (&gt; b c)
          (+ a b)
          (+ a c))
      (<span style="color: #d1f1a9;">if</span> (&gt; a c)
          (+ a b)
          (+ b c))))
(func 4 2 3)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline4" class="outline-3">
<h3 id="orgheadline4"><span class="section-number-3">1.4</span> Exercise 1.4</h3>
</div>
<div id="outline-container-orgheadline5" class="outline-3">
<h3 id="orgheadline5"><span class="section-number-3">1.5</span> Exercise 1.5</h3>
<div class="outline-text-3" id="text-1-5">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">q</span>) (q))
</pre>
</div>
<p>
This line means to define a <b>non-parameter recursive function</b>. So once it be evaluated, the complier will go into a endless loop.<br  />
The difference between <code>normal order</code> and <code>applicative order</code> is the first one will not eval anything before all the expression is expanded.<br  />
So in this exercise, if the complier is using the <code>applicative order</code> to interpreter the code, it will crash.<br  />
Another interest thing is <code>if</code> syntax. It's a high level structor with a specific process which means there is only one of the expression will be evaluated whatever the predicate is. Hence, if the coplier is using the <code>normal order</code>, the result will be 0.<br  />
</p>
</div>
</div>
<div id="outline-container-orgheadline6" class="outline-3">
<h3 id="orgheadline6"><span class="section-number-3">1.6</span> Exercise 1.6</h3>
<div class="outline-text-3" id="text-1-6">
<p>
Same reason as the <code>Exercise 1.6</code>, the <code>new-if</code> is using the <code>cond</code> syntax, and it will evaluate the predicate and the follow expression at the same time. So it should not be used to stop a recursive process.<br  />
</p>
</div>
</div>
<div id="outline-container-orgheadline7" class="outline-3">
<h3 id="orgheadline7"><span class="section-number-3">1.7</span> Exercise 1.7</h3>
<div class="outline-text-3" id="text-1-7">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">improve</span> guess x)
  (/ (+ guess (/ x guess)) 2))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">abs</span> x)
  (<span style="color: #d1f1a9;">if</span> (&lt; x 0)
      (- x)
      x))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">good-enough?</span> guess last-guess)
  (<span style="color: #d1f1a9;">if</span> (&lt; (abs (- (/ guess last-guess) 1)) 0.01)
      #t
      #f))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">sqrt-iter</span> guess last-guess x)
  (<span style="color: #d1f1a9;">if</span> (= x 0)
      0
      (<span style="color: #d1f1a9;">if</span> (good-enough? guess last-guess)
          guess
          (sqrt-iter (improve guess x) guess x))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">my-sqrt</span> x)
  (sqrt-iter 1.0 x x))

(list
 (my-sqrt 10000)
 (my-sqrt 100)
 (my-sqrt 0.0001)
 (my-sqrt 0))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline8" class="outline-3">
<h3 id="orgheadline8"><span class="section-number-3">1.8</span> Exercise 1.8</h3>
<div class="outline-text-3" id="text-1-8">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">improve</span> guess x)
  (/ (+ (/ x (* guess guess)) (* 2 guess)) 3))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">abs</span> x)
  (<span style="color: #d1f1a9;">if</span> (&lt; x 0)
      (- x)
      x))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">good-enough?</span> guess last-guess)
  (<span style="color: #d1f1a9;">if</span> (&lt; (abs (- (/ guess last-guess) 1)) 0.01)
      #t
      #f))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">cube-iter</span> guess last-guess x)
  (<span style="color: #d1f1a9;">if</span> (= x 0)
      0
      (<span style="color: #d1f1a9;">if</span> (good-enough? guess last-guess)
          guess
          (cube-iter (improve guess x) guess x))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">my-cube</span> x)
  (cube-iter 1.0 x x))

(list
 (my-cube 1000000)
 (my-cube 27)
 (my-cube 0.001)
 (my-cube 0))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline9" class="outline-3">
<h3 id="orgheadline9"><span class="section-number-3">1.9</span> Exercise 1.9</h3>
<div class="outline-text-3" id="text-1-9">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">inc</span> x)
  (+ x 1))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">dec</span> x)
  (- x 1))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">mplus1</span> a b)
  (<span style="color: #d1f1a9;">if</span> (= a 0)
      b
      (inc (mplus1 (dec a) b))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">mplus2</span> a b)
  (<span style="color: #d1f1a9;">if</span> (= a 0)
      b
      (mplus2 (dec a) (inc b))))

(list (list (mplus1 4 5)
            (inc (mplus1 3 5))
            (inc (inc (mplus1 2 5)))
            (inc (inc (inc (mplus1 1 5))))
            (inc (inc (inc (inc (mplus1 0 5)))))
            (inc (inc (inc (inc 5))))
            (inc (inc (inc 6)))
            (inc (inc 7))
            (inc 8)
            9)

      (list (mplus2 4 5)
            (mplus2 3 6)
            (mplus2 2 7)
            (mplus2 1 8)
            (mplus2 0 9)
            9))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline10" class="outline-3">
<h3 id="orgheadline10"><span class="section-number-3">1.10</span> Exercise 1.10</h3>
<div class="outline-text-3" id="text-1-10">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">A</span> x y)
  (<span style="color: #d1f1a9;">cond</span> ((= y 0) 0)
        ((= x 0) (* 2 y))
        ((= y 1) 2)
        (<span style="color: #d1f1a9;">else</span> (A (- x 1)
                 (A x (- y 1))))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">f</span> n) (A 0 n))  <span style="color: #7285b7; font-style: italic;">;;</span><span style="color: #7285b7; font-style: italic;">2y</span>

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">g</span> n) (A 1 n))  <span style="color: #7285b7; font-style: italic;">;;</span><span style="color: #7285b7; font-style: italic;">2^n</span>

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">h</span> n) (A 2 n))  <span style="color: #7285b7; font-style: italic;">;;</span><span style="color: #7285b7; font-style: italic;">2^(2^n)</span>

(list (A 1 10)
      (A 2 4)
      (A 3 3))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline11" class="outline-3">
<h3 id="orgheadline11"><span class="section-number-3">1.11</span> Exercise 1.11</h3>
<div class="outline-text-3" id="text-1-11">
<ul class="org-ul">
<li>Tree Recursion<br  /></li>
</ul>
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">f</span> n)
  (<span style="color: #d1f1a9;">if</span> (&lt; n 3)
      n
      (+ (f (- n 1))
         (* 2 (f (- n 2)))
         (* 3 (f (- n 3))))))

(list (f 2)
      (f 3)
      (f 4)
      (f 5)
      (f 6)
      (f 7)
      (f 8)
      (f 9))
</pre>
</div>

<ul class="org-ul">
<li>Iteration Recursion<br  /></li>
</ul>
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">iter-f</span> c lc llc n)
  (<span style="color: #d1f1a9;">cond</span> ((&lt; n 2) n)
        ((= n 2) c)
        (<span style="color: #d1f1a9;">else</span> (iter-f (+ c (* 2 lc) (* 3 llc))
                      c
                      lc
                      (- n 1)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">f</span> n)
  (iter-f 2 1 0 n))

(list (f 2)
      (f 3)
      (f 4)
      (f 5)
      (f 6)
      (f 7)
      (f 8)
      (f 9))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline12" class="outline-3">
<h3 id="orgheadline12"><span class="section-number-3">1.12</span> Exercise 1.12</h3>
<div class="outline-text-3" id="text-1-12">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">pp</span> n i)
  (<span style="color: #d1f1a9;">if</span> (<span style="color: #d1f1a9;">or</span> (= n i) (= i 1))
      1
      (+ (pp (- n 1) (- i 1))
         (pp (- n 1) i))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">iter-p</span> l i n)
  (<span style="color: #d1f1a9;">if</span> (&lt; i n)
      (iter-p (cons (pp n (+ i 1)) l)
              (+ i 1)
              n)
      l))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">p</span> n)
  (iter-p (list (pp n 1))
          1
          n))

(list (p 2)
      (p 3)
      (p 4)
      (p 5)
      (p 6))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline13" class="outline-3">
<h3 id="orgheadline13"><span class="section-number-3">1.13</span> Exercise 1.13 1.14 1.15</h3>
<div class="outline-text-3" id="text-1-13">
<p>
What the hell!<br  />
</p>
</div>
</div>
<div id="outline-container-orgheadline14" class="outline-3">
<h3 id="orgheadline14"><span class="section-number-3">1.14</span> Exercise 1.16</h3>
<div class="outline-text-3" id="text-1-14">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">even?</span> n)
  (= (remainder n 2) 0))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">square</span> n)
  (* n n))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">fast-expt-iter</span> a b n)
  (<span style="color: #d1f1a9;">cond</span> ((= n 0) a)
        ((even? n) (fast-expt-iter a (square b) (/ n 2)))
        (<span style="color: #d1f1a9;">else</span> (fast-expt-iter (* a b) b (- n 1)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">fast-expt</span> b n)
  (fast-expt-iter 1 b n))

(list (fast-expt 2 5)
      (fast-expt 2 8)
      (fast-expt 2 10)
      (fast-expt 2 11))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline15" class="outline-3">
<h3 id="orgheadline15"><span class="section-number-3">1.15</span> Exercise 1.17 1.18</h3>
<div class="outline-text-3" id="text-1-15">
<p>
Using commutation law<br  />
</p>
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">even?</span> n)
  (= (remainder n 2) 0))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">double</span> n)
  (+ n n))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">halve</span> n)
  (/ n 2))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">fast-mult-iter</span> a b n)
  (<span style="color: #d1f1a9;">cond</span> ((= n 0) a)
        ((even? n) (fast-mult-iter a (double b) (halve n)))
        (<span style="color: #d1f1a9;">else</span> (fast-mult-iter (+ a b) b (- n 1)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">fast-mult</span> b n)
  (<span style="color: #d1f1a9;">if</span> (&lt; b n)
      (fast-mult-iter 0 n b)
      (fast-mult-iter 0 b n)))

(list (fast-mult 3 7)
      (fast-mult 5 9)
      (fast-mult 19 111)
      (fast-mult 111 19))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline16" class="outline-3">
<h3 id="orgheadline16"><span class="section-number-3">1.16</span> exercise 1.19</h3>
<div class="outline-text-3" id="text-1-16">
<p>
q &lt;- q^2<sup>nil</sup> + 2pq<br  />
p &lt;- p^2 + q^2<br  />
</p>
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">even?</span> n)
  (= (remainder n 2) 0))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">fib-iter</span> a b p q count)
  (<span style="color: #d1f1a9;">cond</span> ((= count 0) b)
        ((even? count) (fib-iter a
                                 b
                                 (+ (* p p) (* q q))
                                 (+ (* 2 p q) (* q q))
                                 (/ count 2)))
        (<span style="color: #d1f1a9;">else</span> (fib-iter (+ (* b q) (* a (+ p q)))
                        (+ (* b p) (* a q))
                        p
                        q
                        (- count 1)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">fib</span> n)
  (fib-iter 1 0 0 1 n))

(list (fib 1)
      (fib 2)
      (fib 3)
      (fib 4)
      (fib 5)
      (fib 6)
      (fib 7))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline17" class="outline-3">
<h3 id="orgheadline17"><span class="section-number-3">1.17</span> Exercise 1.20</h3>
<div class="outline-text-3" id="text-1-17">
<p>
正则序:<br  />
</p>
<div class="org-src-container">

<pre class="src src-scheme">(list (gcd 206 40)
      (gcd 40 (remainder 206 40))
      (gcd (remainder 206 40) (remainder 40 (remainder 206 40)))
      (gcd (remainder 40 (remainder 206 40))
           (remainder (remainder 206 40) (remainder 40 (remainder 206 40))))
      (gcd (remainder (remainder 206 40) (remainder 40 (remainder 206 40)))
           (remainder (remainder 40 (remainder 206 40))
                      (remainder (remainder 206 40) (remainder 40 (remainder 206 40)))))
      (remainder (remainder 206 40) (remainder 40 (remainder 206 40))))
</pre>
</div>

<p>
IF: 0 + 1 + 2 + 4 + 7<br  />
GCD: 4<br  />
SUM: 18<br  />
</p>

<p>
应用序:<br  />
</p>
<div class="org-src-container">

<pre class="src src-scheme">(list (gcd 206 40)
      (gcd 40 6)
      (gcd 6 4)
      (gcd 4 2)
      (gcd 2 0))
</pre>
</div>

<p>
IF: 0<br  />
GCD: 4<br  />
SUM: 4<br  />
</p>
</div>
</div>

<div id="outline-container-orgheadline18" class="outline-3">
<h3 id="orgheadline18"><span class="section-number-3">1.18</span> Exercise 1.21</h3>
<div class="outline-text-3" id="text-1-18">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">square</span> n)
  (* n n))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">smallest-divisor</span> n)
  (find-divisor n 2))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">find-divisor</span> n test-divisor)
  (<span style="color: #d1f1a9;">cond</span> ((&gt; (square test-divisor) n) n)
        ((divides? test-divisor n) test-divisor)
        (<span style="color: #d1f1a9;">else</span> (find-divisor n (+ test-divisor 1)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">divides?</span> a n)
  (= (remainder n a) 0))

(list (smallest-divisor 199)
      (smallest-divisor 1999)
      (smallest-divisor 19999))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline19" class="outline-3">
<h3 id="orgheadline19"><span class="section-number-3">1.19</span> Exercise 1.22</h3>
<div class="outline-text-3" id="text-1-19">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">my-return</span>)
  (display <span style="color: #99ffff;">"loading ..."</span>)
  5)

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">lazy</span> (my-return))

(list lazy
      lazy
      lazy)
</pre>
</div>


<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">square</span> n)
  (* n n))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">smallest-divisor</span> n)
  (find-divisor n 2))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">find-divisor</span> n test-divisor)
  (<span style="color: #d1f1a9;">cond</span> ((&gt; (square test-divisor) n) n)
        ((divides? test-divisor n) test-divisor)
        (<span style="color: #d1f1a9;">else</span> (find-divisor n (+ test-divisor 1)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">divides?</span> a n)
  (= (remainder n a) 0))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">prime?</span> n)
  (= n (smallest-divisor n)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">runtime</span>)
  (tms:clock (times)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">time-prime-test</span> n)
  (start-prime-test n (runtime)))

<span style="color: #7285b7; font-style: italic;">;; </span><span style="color: #7285b7; font-style: italic;">Need to change this</span>
(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">start-prime-test</span> n start-time)
  (<span style="color: #d1f1a9;">if</span> (prime? n)
      (<span style="color: #d1f1a9;">begin</span> (newline)
             (display n)
             (report-prime (- (runtime) start-time))
             #t)
      #f))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">report-prime</span> elapsed-time)
  (display <span style="color: #99ffff;">" ** "</span>)
  (display elapsed-time))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">next-odd</span> n)
  (<span style="color: #d1f1a9;">if</span> (= (remainder n 2) 0)
      (+ n 1)
      (+ n 2)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">search-for-primes-iter</span> i n)
  (<span style="color: #d1f1a9;">if</span> (&gt; i 0)
      (<span style="color: #d1f1a9;">if</span> (time-prime-test n)
          (search-for-primes-iter (- i 1) (next-odd n))
          (search-for-primes-iter i (next-odd n)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">search-for-primes</span> n)
  (search-for-primes-iter 3 n))

(list (search-for-primes 1000)
      (search-for-primes 10000)
      (search-for-primes 100000)
      (search-for-primes 1000000)
      (search-for-primes 10000000)
      (search-for-primes 100000000)
      (search-for-primes 1000000000)
      (search-for-primes 10000000000)
      (search-for-primes 100000000000)
      (search-for-primes 1000000000000))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline20" class="outline-3">
<h3 id="orgheadline20"><span class="section-number-3">1.20</span> Exercise 1.23</h3>
<div class="outline-text-3" id="text-1-20">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">square</span> n)
  (* n n))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">smallest-divisor</span> n)
  (find-divisor n 2))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">next</span> n)
  (<span style="color: #d1f1a9;">if</span> (= n 2)
      3
      (+ n 2)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">find-divisor</span> n test-divisor)
  (<span style="color: #d1f1a9;">cond</span> ((&gt; (square test-divisor) n) n)
        ((divides? test-divisor n) test-divisor)
        (<span style="color: #d1f1a9;">else</span> (find-divisor n (next test-divisor)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">divides?</span> a n)
  (= (remainder n a) 0))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">prime?</span> n)
  (= n (smallest-divisor n)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">runtime</span>)
  (tms:clock (times)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">time-prime-test</span> n)
  (start-prime-test n (runtime)))

<span style="color: #7285b7; font-style: italic;">;; </span><span style="color: #7285b7; font-style: italic;">Need to change this</span>
(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">start-prime-test</span> n start-time)
  (<span style="color: #d1f1a9;">if</span> (prime? n)
      (<span style="color: #d1f1a9;">begin</span> (newline)
             (display n)
             (report-prime (- (runtime) start-time))
             #t)
      #f))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">report-prime</span> elapsed-time)
  (display <span style="color: #99ffff;">" ** "</span>)
  (display elapsed-time))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">next-odd</span> n)
  (<span style="color: #d1f1a9;">if</span> (= (remainder n 2) 0)
      (+ n 1)
      (+ n 2)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">search-for-primes-iter</span> i n)
  (<span style="color: #d1f1a9;">if</span> (&gt; i 0)
      (<span style="color: #d1f1a9;">if</span> (time-prime-test n)
          (search-for-primes-iter (- i 1) (next-odd n))
          (search-for-primes-iter i (next-odd n)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">search-for-primes</span> n)
  (search-for-primes-iter 3 n))

(list (search-for-primes 1000)
      (search-for-primes 10000)
      (search-for-primes 100000)
      (search-for-primes 1000000)
      (search-for-primes 10000000)
      (search-for-primes 100000000)
      (search-for-primes 1000000000)
      (search-for-primes 10000000000)
      (search-for-primes 100000000000)
      (search-for-primes 1000000000000))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline21" class="outline-3">
<h3 id="orgheadline21"><span class="section-number-3">1.21</span> Exercise 1.24</h3>
<div class="outline-text-3" id="text-1-21">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">square</span> n)
  (* n n))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">even?</span> n)
  (= (remainder n 2) 0))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">expmod</span> base exp m)
  (<span style="color: #d1f1a9;">cond</span> ((= exp 0) 1)
        ((even? exp)
         (remainder (square (expmod base (/ exp 2) m))
                    m))
        (<span style="color: #d1f1a9;">else</span>
         (remainder (* base (expmod base (- exp 1) m))
                    m))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">fermat-test</span> n)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">try-it</span> a)
    (= (expmod a n n) a))
  (try-it (+ 1 (random (- n 1)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">fast-prime?</span> n times)
  (<span style="color: #d1f1a9;">cond</span> ((= times 0) #t)
        ((fermat-test n) (fast-prime? n (- times 1)))
        (<span style="color: #d1f1a9;">else</span> #f)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">runtime</span>)
  (tms:clock (times)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">time-prime-test</span> n)
  (start-prime-test n (runtime)))

<span style="color: #7285b7; font-style: italic;">;; </span><span style="color: #7285b7; font-style: italic;">Need to change this</span>
(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">start-prime-test</span> n start-time)
  (<span style="color: #d1f1a9;">if</span> (fast-prime? n 100)
      (<span style="color: #d1f1a9;">begin</span> (newline)
             (display n)
             (report-prime (- (runtime) start-time))
             #t)
      #f))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">report-prime</span> elapsed-time)
  (display <span style="color: #99ffff;">" ** "</span>)
  (display elapsed-time))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">next-odd</span> n)
  (<span style="color: #d1f1a9;">if</span> (= (remainder n 2) 0)
      (+ n 1)
      (+ n 2)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">search-for-primes-iter</span> i n)
  (<span style="color: #d1f1a9;">if</span> (&gt; i 0)
      (<span style="color: #d1f1a9;">if</span> (time-prime-test n)
          (search-for-primes-iter (- i 1) (next-odd n))
          (search-for-primes-iter i (next-odd n)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">search-for-primes</span> n)
  (search-for-primes-iter 3 n))

(list (search-for-primes 1000)
      (search-for-primes 10000)
      (search-for-primes 100000)
      (search-for-primes 1000000)
      (search-for-primes 10000000)
      (search-for-primes 100000000)
      (search-for-primes 1000000000)
      (search-for-primes 10000000000)
      (search-for-primes 100000000000)
      (search-for-primes 1000000000000))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline22" class="outline-3">
<h3 id="orgheadline22"><span class="section-number-3">1.22</span> Exercise 1.28</h3>
<div class="outline-text-3" id="text-1-22">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">square</span> n)
  (* n n))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">even?</span> n)
  (= (remainder n 2) 0))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">trivial-square-test</span> a n )
  (<span style="color: #d1f1a9;">if</span> (<span style="color: #d1f1a9;">and</span> (not (= a 1))
           (not (= a (- n 1)))
           (= (remainder (square a) n) 1))
      0
      a))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">expmod</span> base exp m)
  (<span style="color: #d1f1a9;">cond</span> ((= exp 0) 1)
        ((even? exp)
         (remainder (square (trivial-square-test (expmod base (/ exp 2) m) m))
                    m))
        (<span style="color: #d1f1a9;">else</span>
         (remainder (* base (expmod base (- exp 1) m))
                    m))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">rabin-test</span> n)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">try-it</span> a)
    (= (expmod a (- n 1) n) 1))
  (try-it (+ 1 (random (- n 1)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">fast-prime?</span> n times)
  (<span style="color: #d1f1a9;">cond</span> ((= times 0) #t)
        ((rabin-test n) (fast-prime? n (- times 1)))
        (<span style="color: #d1f1a9;">else</span> #f)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">runtime</span>)
  (tms:clock (times)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">time-prime-test</span> n)
  (start-prime-test n (runtime)))

<span style="color: #7285b7; font-style: italic;">;; </span><span style="color: #7285b7; font-style: italic;">Need to change this</span>
(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">start-prime-test</span> n start-time)
  (<span style="color: #d1f1a9;">if</span> (fast-prime? n 100)
      (<span style="color: #d1f1a9;">begin</span> (newline)
             (display n)
             (report-prime (- (runtime) start-time))
             #t)
      #f))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">report-prime</span> elapsed-time)
  (display <span style="color: #99ffff;">" ** "</span>)
  (display elapsed-time))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">next-odd</span> n)
  (<span style="color: #d1f1a9;">if</span> (= (remainder n 2) 0)
      (+ n 1)
      (+ n 2)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">search-for-primes-iter</span> i n)
  (<span style="color: #d1f1a9;">if</span> (&gt; i 0)
      (<span style="color: #d1f1a9;">if</span> (time-prime-test n)
          (search-for-primes-iter (- i 1) (next-odd n))
          (search-for-primes-iter i (next-odd n)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">search-for-primes</span> n)
  (search-for-primes-iter 3 n))

(list (search-for-primes 1000)
      (search-for-primes 10000)
      (search-for-primes 100000)
      (search-for-primes 1000000)
      (search-for-primes 10000000)
      (search-for-primes 100000000)
      (search-for-primes 1000000000)
      (search-for-primes 10000000000)
      (search-for-primes 100000000000)
      (search-for-primes 1000000000000))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline23" class="outline-3">
<h3 id="orgheadline23"><span class="section-number-3">1.23</span> Exercise 1.29</h3>
<div class="outline-text-3" id="text-1-23">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">sum</span> term a next b)
  (<span style="color: #d1f1a9;">if</span> (&gt; a b)
      0
      (+ (term a)
         (sum term (next a) next b))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">integral</span> f a b n)
  (<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">h</span> (/ (- b a) n))
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">new-f</span> i)
    (* (+ 2 (* 2 (remainder i 2)))
       (f (+ a (* i h)))))
  (/ (* h
        (+ (f a)
           (f b)
           (sum new-f 1 (<span style="color: #d1f1a9;">lambda</span> (x) (+ x 1)) (- n 1))))
     3.0))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">cube</span> x)
  (* x x x))

(list (integral cube 0 1.0 100)
      (integral cube 0 1.0 1000))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline24" class="outline-3">
<h3 id="orgheadline24"><span class="section-number-3">1.24</span> Exercise 1.30</h3>
<div class="outline-text-3" id="text-1-24">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">sum</span> term a next b)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">iter</span> a result)
    (<span style="color: #d1f1a9;">if</span> (&gt; a b)
        result
        (iter (next a)
              (+ result (term a)))))
  (iter a 0))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">inc</span> x)
  (+ x 1))

(list (sum (<span style="color: #d1f1a9;">lambda</span> (x) x) 1 inc 10)
      (sum (<span style="color: #d1f1a9;">lambda</span> (x) (* x x x)) 1 inc 10))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline25" class="outline-3">
<h3 id="orgheadline25"><span class="section-number-3">1.25</span> Exercise 1.31</h3>
<div class="outline-text-3" id="text-1-25">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">product</span> term a next b)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">iter</span> a result)
    (<span style="color: #d1f1a9;">if</span> (&gt; a b)
        result
        (iter (next a)
              (* result (term a)))))
  (iter a 1))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">inc</span> x)
  (+ x 1))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">square</span> x)
  (* x x))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">factorial</span> n)
  (product (<span style="color: #d1f1a9;">lambda</span> (x) x) 1 inc n))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">PI</span>)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">like-PI</span> n)
    (* 4.0
       (/ 2 (+ 3 (* n 2)))
       (product (<span style="color: #d1f1a9;">lambda</span> (x) (square (/ (+ 2 (* x 2))
                                       (+ 1 (* x 2))))) 1 inc n)))
  (like-PI 10000))

(list (factorial 5)
      (PI))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline26" class="outline-3">
<h3 id="orgheadline26"><span class="section-number-3">1.26</span> Exercise 1.32</h3>
<div class="outline-text-3" id="text-1-26">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">accumulate</span> combiner null-value term a next b)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">iter</span> a result)
    (<span style="color: #d1f1a9;">if</span> (&gt; a b)
        result
        (iter (next a)
              (combiner result (term a)))))
  (iter a null-value))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">sum</span> term a next b)
  (accumulate (<span style="color: #d1f1a9;">lambda</span> (x y) (+ x y))
              0
              term a next b))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">inc</span> x)
  (+ x 1))

(list (sum (<span style="color: #d1f1a9;">lambda</span> (x) x) 0 inc 10))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline27" class="outline-3">
<h3 id="orgheadline27"><span class="section-number-3">1.27</span> Exercise 1.33</h3>
<div class="outline-text-3" id="text-1-27">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">square</span> n)
  (* n n))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">smallest-divisor</span> n)
  (find-divisor n 2))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">next</span> n)
  (<span style="color: #d1f1a9;">if</span> (= n 2)
      3
      (+ n 2)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">find-divisor</span> n test-divisor)
  (<span style="color: #d1f1a9;">cond</span> ((&gt; (square test-divisor) n) n)
        ((divides? test-divisor n) test-divisor)
        (<span style="color: #d1f1a9;">else</span> (find-divisor n (next test-divisor)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">divides?</span> a n)
  (= (remainder n a) 0))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">prime?</span> n)
  (= n (smallest-divisor n)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">filtered-accumulate</span> filter combiner null-value term a next b)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">iter</span> a result)
    (<span style="color: #d1f1a9;">cond</span> ((&gt; a b) result)
          ((filter a) (iter (next a)
                            (combiner result (term a))))
          (<span style="color: #d1f1a9;">else</span> (iter (next a) result))))
  (iter a null-value))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">sum</span> term a next b)
  (filtered-accumulate (<span style="color: #d1f1a9;">lambda</span> (x) #t)
                       (<span style="color: #d1f1a9;">lambda</span> (x y) (+ x y))
                       0
                       term a next b))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">inc</span> x)
  (+ x 1))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">prime-sum</span> a b)
  (filtered-accumulate prime?
                       (<span style="color: #d1f1a9;">lambda</span> (x y) (+ x y))
                       0
                       (<span style="color: #d1f1a9;">lambda</span> (x) x)
                       a
                       inc
                       b))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">prime-n</span> n)
  (filtered-accumulate (<span style="color: #d1f1a9;">lambda</span> (x)
                         (= (gcd x n)
                            1))
                       (<span style="color: #d1f1a9;">lambda</span> (x y) (+ x y))
                       0
                       (<span style="color: #d1f1a9;">lambda</span> (x) x)
                       1
                       inc
                       n))

(list (sum (<span style="color: #d1f1a9;">lambda</span> (x) x) 0 inc 10)
      (prime-sum 0 10)
      (prime-n 10))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline28" class="outline-3">
<h3 id="orgheadline28"><span class="section-number-3">1.28</span> Exercise 1.34</h3>
<div class="outline-text-3" id="text-1-28">
<p>
Give a error to use <code>2</code> as a function.<br  />
</p>
</div>
</div>
<div id="outline-container-orgheadline29" class="outline-3">
<h3 id="orgheadline29"><span class="section-number-3">1.29</span> Exercise 1.35</h3>
<div class="outline-text-3" id="text-1-29">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">tolerance</span> 0.00001)

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">fixed-point</span> f guess)
  (<span style="color: #d1f1a9;">let</span> ((next-guess (f guess)))
    (<span style="color: #d1f1a9;">begin</span> (display next-guess)
           (newline)
           (<span style="color: #d1f1a9;">if</span> (&gt; tolerance
                  (abs (- guess next-guess)))
               next-guess
               (fixed-point f next-guess)))))

(fixed-point (<span style="color: #d1f1a9;">lambda</span> (x) (+ 1 (/ 1 x))) 1.0)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline30" class="outline-3">
<h3 id="orgheadline30"><span class="section-number-3">1.30</span> Exercise 1.36</h3>
<div class="outline-text-3" id="text-1-30">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">tolerance</span> 0.00001)

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">average</span> x y)
  (/ (+ x y)
     2))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">fixed-point</span> f guess)
  (<span style="color: #d1f1a9;">let</span> ((next-guess (f guess)))
    (<span style="color: #d1f1a9;">begin</span> (display next-guess)
           (newline)
           (<span style="color: #d1f1a9;">if</span> (&gt; tolerance
                  (abs (- guess next-guess)))
               next-guess
               (fixed-point f next-guess)))))

(fixed-point (<span style="color: #d1f1a9;">lambda</span> (x)
               (<span style="color: #d1f1a9;">let</span> ((log1000 (log 1000)))
                 (/ log1000 (log x))))
             10.0)

(newline)

(fixed-point (<span style="color: #d1f1a9;">lambda</span> (x)
               (<span style="color: #d1f1a9;">let</span> ((log1000 (log 1000)))
                 (average (/ log1000 (log x))
                          x)))
             10.0)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline31" class="outline-3">
<h3 id="orgheadline31"><span class="section-number-3">1.31</span> Exercise 1.37</h3>
<div class="outline-text-3" id="text-1-31">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">cont-frac</span> N D k)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">cont-frac-recur</span> i)
    (<span style="color: #d1f1a9;">if</span> (&gt; i k)
        0
        (/ (N i) (+ (D i)
                    (cont-frac-recur (+ i 1))))))
  (cont-frac-recur 1))

(/ 1 (cont-frac (<span style="color: #d1f1a9;">lambda</span> (i) 1.0)
                (<span style="color: #d1f1a9;">lambda</span> (i) 1.0)
                100))
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">cont-frac</span> N D k)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">cont-frac-iter</span> i result)
    (<span style="color: #d1f1a9;">if</span> (= i 1)
        result
        (cont-frac-iter (- i 1)
                        (/ (N i) (+ (D i) result)))))
  (cont-frac-iter k 0))

(/ 1 (cont-frac (<span style="color: #d1f1a9;">lambda</span> (i) 1.0)
                (<span style="color: #d1f1a9;">lambda</span> (i) 1.0)
                100))
</pre>
</div>

<p>
CPS iteration<br  />
</p>
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">identity</span> x) x)

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">cont-frac</span> N D k)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">cont-frac-cps</span> i f)
    (<span style="color: #d1f1a9;">if</span> (&gt; i k)
        (f 0)
        (cont-frac-cps (+ i 1)
                       (<span style="color: #d1f1a9;">lambda</span> (x)
                         (f (/ (N i)
                               (+ (D i) x)))))))
  (cont-frac-cps 1 identity))

(/ 1 (cont-frac (<span style="color: #d1f1a9;">lambda</span> (i) 1.0)
                (<span style="color: #d1f1a9;">lambda</span> (i) 1.0)
                100))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline32" class="outline-3">
<h3 id="orgheadline32"><span class="section-number-3">1.32</span> Exercise 1.38</h3>
<div class="outline-text-3" id="text-1-32">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">identity</span> x) x)

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">cont-frac</span> N D k)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">cont-frac-cps</span> i f)
    (<span style="color: #d1f1a9;">if</span> (&gt; i k)
        (f 0)
        (cont-frac-cps (+ i 1)
                       (<span style="color: #d1f1a9;">lambda</span> (x)
                         (f (/ (N i)
                               (+ (D i) x)))))))
  (cont-frac-cps 1 identity))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">D</span> i)
  (<span style="color: #d1f1a9;">if</span> (= (remainder i 3) 2)
      (* 2 (ceiling-quotient i 3))
      1))

(+ 2 (cont-frac (<span style="color: #d1f1a9;">lambda</span> (i) 1.0)
                D
                100))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline33" class="outline-3">
<h3 id="orgheadline33"><span class="section-number-3">1.33</span> Exercise 1.39</h3>
<div class="outline-text-3" id="text-1-33">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">identity</span> x) x)

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">cont-frac</span> N D k)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">cont-frac-cps</span> i f)
    (<span style="color: #d1f1a9;">if</span> (&gt; i k)
        (f 0)
        (cont-frac-cps (+ i 1)
                       (<span style="color: #d1f1a9;">lambda</span> (x)
                         (f (/ (N i)
                               (+ (D i) x)))))))
  (cont-frac-cps 1 identity))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">tan-cf</span> x k)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">D</span> i)
    (- (* i 2) 1))
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">N</span> i)
    (<span style="color: #d1f1a9;">if</span> (= i 1)
        x
        (- (* x x))))
  (cont-frac N D k))

(list (tan-cf (/ 3.1415926 4) 100)
      (tan (/ 3.1415926 4)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline34" class="outline-3">
<h3 id="orgheadline34"><span class="section-number-3">1.34</span> Exercise 1.40</h3>
<div class="outline-text-3" id="text-1-34">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">tolerance</span> 0.00001)

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">fixed-point</span> f guess)
  (<span style="color: #d1f1a9;">let</span> ((next-guess (f guess)))
    (<span style="color: #d1f1a9;">begin</span> (display next-guess)
           (newline)
           (<span style="color: #d1f1a9;">if</span> (&gt; tolerance
                  (abs (- guess next-guess)))
               next-guess
               (fixed-point f next-guess)))))

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">dx</span> 0.00001)

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">deriv</span> g)
  (<span style="color: #d1f1a9;">lambda</span> (x)
    (/ (- (g (+ x dx)) (g x))
       dx)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">newton-transform</span> g)
  (<span style="color: #d1f1a9;">lambda</span> (x)
    (- x (/ (g x) ((deriv g) x)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">newton-method</span> g guess)
  (fixed-point (newton-transform g) guess))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">cubic</span> a b c)
  (<span style="color: #d1f1a9;">lambda</span> (x) (+ (* x x x)
                 (* a x x)
                 (* b x)
                 (* c))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">polynomial</span> a b c)
  (newton-method (cubic a b c) 1))

(polynomial 0 0 1)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline35" class="outline-3">
<h3 id="orgheadline35"><span class="section-number-3">1.35</span> Exercise 1.41</h3>
<div class="outline-text-3" id="text-1-35">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">double</span> f)
  (<span style="color: #d1f1a9;">lambda</span> (x) (f (f x))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">inc</span> x)
  (+ x 1))

(((double (double double)) inc) 5) <span style="color: #7285b7; font-style: italic;">#|(double (double (double (double inc))))|#</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline36" class="outline-3">
<h3 id="orgheadline36"><span class="section-number-3">1.36</span> Exercise 1.42</h3>
<div class="outline-text-3" id="text-1-36">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">compose</span> f g)
  (<span style="color: #d1f1a9;">lambda</span> (x)
    (f (g x))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">square</span> x)
  (* x x))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">inc</span> x)
  (+ x 1))

((compose square inc) 6)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline37" class="outline-3">
<h3 id="orgheadline37"><span class="section-number-3">1.37</span> Exercise 1.43</h3>
<div class="outline-text-3" id="text-1-37">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">id</span> x)
  x)

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">repeated</span> f n)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">repeated-iter</span> fsum i)
    (<span style="color: #d1f1a9;">cond</span> ((= n 0) id)
          ((= i n) fsum)
          (<span style="color: #d1f1a9;">else</span> (repeated-iter (<span style="color: #d1f1a9;">lambda</span> (x) (f (fsum x)))
                               (+ i 1)))))
  (repeated-iter id 0))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">square</span> x)
  (* x x))

((repeated square 2) 5)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline38" class="outline-3">
<h3 id="orgheadline38"><span class="section-number-3">1.38</span> Exercise 1.44</h3>
<div class="outline-text-3" id="text-1-38">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">id</span> x)
  x)

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">repeated</span> f n)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">repeated-iter</span> fsum i)
    (<span style="color: #d1f1a9;">cond</span> ((= n 0) id)
          ((= i n) fsum)
          (<span style="color: #d1f1a9;">else</span> (repeated-iter (<span style="color: #d1f1a9;">lambda</span> (x) (f (fsum x)))
                               (+ i 1)))))
  (repeated-iter id 0))

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">epsonlon</span> 0.00001)

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">smooth</span> f)
  (<span style="color: #d1f1a9;">lambda</span> (x)
    (/ (+ (f (- x epsonlon)) (f x) (f (+ x epsonlon))) 3)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">repeated-smooth</span> f n)
  ((repeated smooth n) f))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">square</span> x)
  (* x x))

((repeated-smooth square 5) 5)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline39" class="outline-3">
<h3 id="orgheadline39"><span class="section-number-3">1.39</span> Exercise 1.45</h3>
<div class="outline-text-3" id="text-1-39">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">id</span> x) x)

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">tolerance</span> 0.00001)

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">repeated</span> f n)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">repeated-iter</span> fsum i)
    (<span style="color: #d1f1a9;">cond</span> ((= n 0) id)
          ((= i n) fsum)
          (<span style="color: #d1f1a9;">else</span> (repeated-iter (<span style="color: #d1f1a9;">lambda</span> (x) (f (fsum x)))
                               (+ i 1)))))
  (repeated-iter id 0))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">average</span> x y)
  (/ (+ x y)
     2))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">average-damp</span> f)
  (<span style="color: #d1f1a9;">lambda</span> (x) (average x (f x))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">average-n-times</span> f n)
  ((repeated average-damp n) f))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">power</span> x n)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">power-iter</span> i acc)
    (<span style="color: #d1f1a9;">if</span> (= i n)
        acc
        (power-iter (+ i 1) (* acc x))))
  (power-iter 0 1))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">lg2</span> n)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">lg2-iter</span> acc remain)
    (<span style="color: #d1f1a9;">if</span> (&lt; remain 1)
        acc
        (lg2-iter (+ acc 1) (/ remain 2))))
  (lg2-iter 0 (/ n 2)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">n-th-root</span> n x)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">fixed-point</span> f guess)
    (<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">next-guess</span> ((average-n-times f (lg2 n)) guess))
    (display next-guess)
    (newline)
    (<span style="color: #d1f1a9;">if</span> (&gt; tolerance (abs (- guess next-guess)))
        next-guess
        (fixed-point f next-guess)))
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">f</span> y) (/ x (power y (- n 1))))
  (fixed-point f 1.0))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">square</span> x)
  (* x x))

(n-th-root 5 32)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline40" class="outline-3">
<h3 id="orgheadline40"><span class="section-number-3">1.40</span> Exercise 1.46</h3>
<div class="outline-text-3" id="text-1-40">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">abs</span> x)
  (<span style="color: #d1f1a9;">if</span> (&lt; x 0)
      (- x)
      x))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">iterative-improve</span> good-enough? update-guess)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">iter-func</span> guess)
    (<span style="color: #d1f1a9;">let</span> ((last-guess guess)
          (updated-guess (update-guess guess)))
      (<span style="color: #d1f1a9;">if</span> (good-enough? updated-guess last-guess)
          updated-guess
          (iter-func updated-guess))))
  iter-func)

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">sqrt</span> n)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">sqrt-good-enough?</span> guess last-guess)
    (<span style="color: #d1f1a9;">if</span> (&lt; (abs (- (/ guess last-guess) 1)) 0.00001) #t #f))
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">sqrt-update-guess</span> guess)
    (/ (+ guess (/ n guess)) 2))
  ((iterative-improve sqrt-good-enough? sqrt-update-guess) 2.0))

(sqrt 100)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">f</span>)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">g</span> x y) (+ x y))
  (<span style="color: #d1f1a9;">lambda</span> (x y) (g x y)))

((f) 33 44)
</pre>
</div>


<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">iterative-improve</span> good-enough? update-guess)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">iter-func</span> guess)
    (<span style="color: #d1f1a9;">let</span> ((last-guess guess)
          (updated-guess (update-guess guess)))
      (<span style="color: #d1f1a9;">if</span> (good-enough? updated-guess last-guess)
          updated-guess
          (iter-func updated-guess))))
  (<span style="color: #d1f1a9;">lambda</span> (guess) (iter-func guess)))

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">tolerance</span> 0.00001)

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">fixed-point</span> f guess)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">fixed-point-good-enough?</span> guess last-guess)
    (&gt; tolerance (abs (- last-guess guess))))
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">fixed-point-update-guess</span> guess)
    (f guess))
  ((iterative-improve fixed-point-good-enough? fixed-point-update-guess) guess))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">average</span> x y)
  (/ (+ x y) 2))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">sqrt</span> x)
  (fixed-point (<span style="color: #d1f1a9;">lambda</span> (y) (average y (/ x y))) 2.0))

(sqrt 100)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline79" class="outline-2">
<h2 id="orgheadline79"><span class="section-number-2">2</span> Building Abstractions with Data</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-orgheadline42" class="outline-3">
<h3 id="orgheadline42"><span class="section-number-3">2.1</span> Exercise 2.1</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">make-rat</span> n d)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">assign</span> x)
    (<span style="color: #d1f1a9;">if</span> (&gt; x 0)
        1
        -1))
  (<span style="color: #d1f1a9;">let</span> ((g (gcd n d))
        (n (abs n))
        (d (abs d))
        (a (assign (* n d))))
    (cons (* (/ n g) a) (/ d g))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">numer</span> x) (car x))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">denom</span> x) (cdr x))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">print-rat</span> x)
  (newline)
  (display (numer x))
  (display <span style="color: #99ffff;">"/"</span>)
  (display (denom x)))

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">num</span> (make-rat 4 -8))

(print-rat num)

num
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline43" class="outline-3">
<h3 id="orgheadline43"><span class="section-number-3">2.2</span> Exercise 2.3</h3>
<div class="outline-text-3" id="text-2-2">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #7285b7; font-style: italic;">#| Utils |#</span>
(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">average</span> x y)
  (/ (+ x y) 2))

<span style="color: #7285b7; font-style: italic;">#| Point Definiation |#</span>
(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">make-point</span> x y)
  (cons x y))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">x-point</span> x)
  (car x))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">y-point</span> x)
  (cdr x))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">print-point</span> p)
  (newline)
  (display <span style="color: #99ffff;">"("</span>)
  (display (x-point p))
  (display <span style="color: #99ffff;">", "</span>)
  (display (y-point p))
  (display <span style="color: #99ffff;">")"</span>))

<span style="color: #7285b7; font-style: italic;">#| Segment Definiation |#</span>
(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">make-segment</span> x y)
  (cons x y))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">start-segment</span> x)
  (car x))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">end-segment</span> x)
  (cdr x))


(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">midpoint-segment</span> s)
  (<span style="color: #d1f1a9;">let</span> ((p1 (start-segment s))
        (p2 (end-segment s)))
    (make-point (average (x-point p1) (x-point p2))
                (average (y-point p1) (y-point p2)))))

<span style="color: #7285b7; font-style: italic;">#| Point Rect Definiation |#</span>
(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">make-point-rect</span> p1 p2)
  (cons p1 p2))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">height-rect</span> r)
  (abs (- (y-point (car r))
          (y-point (cdr r)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">width-rect</span> r)
  (abs (- (x-point (car r))
          (x-point (cdr r)))))

<span style="color: #7285b7; font-style: italic;">#| Implementation |#</span>
(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">perimeter-rect</span> r)
  (* 2 (+ (height-rect r)
          (width-rect r))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">area-rect</span> r)
  (* (height-rect r)
     (width-rect r)))

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">rect</span> (make-point-rect (make-point -1 1)
                              (make-point 5 -8)))

(list (perimeter-rect rect)
      (area-rect rect))
</pre>
</div>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #7285b7; font-style: italic;">#| Utils |#</span>
(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">average</span> x y)
  (/ (+ x y) 2))

<span style="color: #7285b7; font-style: italic;">#| Point Definiation |#</span>
(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">make-point</span> x y)
  (cons x y))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">x-point</span> x)
  (car x))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">y-point</span> x)
  (cdr x))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">print-point</span> p)
  (newline)
  (display <span style="color: #99ffff;">"("</span>)
  (display (x-point p))
  (display <span style="color: #99ffff;">", "</span>)
  (display (y-point p))
  (display <span style="color: #99ffff;">")"</span>))

<span style="color: #7285b7; font-style: italic;">#| Segment Definiation |#</span>
(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">make-segment</span> x y)
  (cons x y))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">start-segment</span> x)
  (car x))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">end-segment</span> x)
  (cdr x))


(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">midpoint-segment</span> s)
  (<span style="color: #d1f1a9;">let</span> ((p1 (start-segment s))
        (p2 (end-segment s)))
    (make-point (average (x-point p1) (x-point p2))
                (average (y-point p1) (y-point p2)))))

<span style="color: #7285b7; font-style: italic;">#| Point Rect Definiation |#</span>
(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">make-pwh-rect</span> p1 width height)
  (cons p1 (cons width height)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">height-rect</span> r)
  (cdr (cdr r)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">width-rect</span> r)
  (car (cdr r)))

<span style="color: #7285b7; font-style: italic;">#| Implementation |#</span>
(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">perimeter-rect</span> r)
  (* 2 (+ (height-rect r)
          (width-rect r))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">area-rect</span> r)
  (* (height-rect r)
     (width-rect r)))

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">rect</span> (make-pwh-rect (make-point -1 1)
                            6
                            9))

(list (perimeter-rect rect)
      (area-rect rect))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline44" class="outline-3">
<h3 id="orgheadline44"><span class="section-number-3">2.3</span> Exercise 2.4</h3>
<div class="outline-text-3" id="text-2-3">
<p>
Church Encoding<br  />
</p>
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">cons</span> x y)
  (<span style="color: #d1f1a9;">lambda</span> (m) (m x y)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">car</span> pair)
  (pair (<span style="color: #d1f1a9;">lambda</span> (x y) x)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">cdr</span> pair)
  (pair (<span style="color: #d1f1a9;">lambda</span> (x y) y)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline45" class="outline-3">
<h3 id="orgheadline45"><span class="section-number-3">2.4</span> Exercise 2.5</h3>
<div class="outline-text-3" id="text-2-4">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">cons</span> x y)
  (* (expt 2 x) (expt 3 y)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">integer-log</span> x y)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">id</span> x) x)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">integer-log-iter</span> x f)
    (<span style="color: #d1f1a9;">let</span> ((quot (/ x y)))
      (<span style="color: #d1f1a9;">if</span> (integer? quot)
          (integer-log-iter quot (<span style="color: #d1f1a9;">lambda</span> (x) (f (+ x 1))))
          (f 0))))
  (integer-log-iter x id))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">car</span> x)
  (integer-log x 2))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">cdr</span> x)
  (integer-log x 3))

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">pair</span> (cons 2 3))

(list pair
      (car pair)
      (cdr pair))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline46" class="outline-3">
<h3 id="orgheadline46"><span class="section-number-3">2.5</span> Exercise 2.6</h3>
<div class="outline-text-3" id="text-2-5">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">zero</span>
  (<span style="color: #d1f1a9;">lambda</span> (f) (<span style="color: #d1f1a9;">lambda</span> (x) x)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">add-1</span> n)
  (<span style="color: #d1f1a9;">lambda</span> (f) (<span style="color: #d1f1a9;">lambda</span> (x) (f ((n f) x)))))

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">one</span>
  (<span style="color: #d1f1a9;">lambda</span> (f) (<span style="color: #d1f1a9;">lambda</span> (x) (f x))))

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">two</span>
  (<span style="color: #d1f1a9;">lambda</span> (f) (<span style="color: #d1f1a9;">lambda</span> (x) (f (f x)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">add</span> a b)
  (<span style="color: #d1f1a9;">lambda</span> (f) (<span style="color: #d1f1a9;">lambda</span> (x)
                ((b f) ((a f) x)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline47" class="outline-3">
<h3 id="orgheadline47"><span class="section-number-3">2.6</span> Exercise 2.7, 2.8, 2.9, 2.10, 2.11. 2.12, 2.13, 2.14, (2.15, 2.16)</h3>
<div class="outline-text-3" id="text-2-6">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #7285b7; font-style: italic;">#| Definition |#</span>

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">make-interval</span> lower-bound upper-bound)
  (cons lower-bound upper-bound))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">make-center-percent</span> c pw)
  (make-center-width c (* c pw)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">make-center-width</span> c w)
  (make-interval (- c w) (+ c w)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">lower-bound</span> x)
  (min (car x) (cdr x)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">upper-bound</span> x)
  (max (car x) (cdr x)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">interval-center</span> x)
  (/ (+ (lower-bound x) (upper-bound x)) 2))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">interval-width</span> x)
  (/ (- (upper-bound x) (lower-bound x)) 2.0))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">interval-percent</span> x)
  (/ (* 100 (interval-width x)) (interval-center x)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">mul-interval-rough-percent</span> x y)
  (+ (interval-percent x) (interval-percent y)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">state</span> x)
  (<span style="color: #d1f1a9;">if</span> (&gt; (* (upper-bound x) (lower-bound x)) 0)
      (<span style="color: #d1f1a9;">if</span> (&gt; (lower-bound x) 0)
          1
          -1)
      0))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">add-interval</span> x y)
  (make-interval (+ (lower-bound x) (lower-bound y))
                 (+ (upper-bound x) (upper-bound y))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">sub-interval</span> x y)
  (make-interval (- (lower-bound x) (upper-bound y))
                 (- (upper-bound x) (lower-bound y))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">mul-interval-1</span> x y)
  (<span style="color: #d1f1a9;">let</span> ((p1 (* (lower-bound x) (lower-bound y)))
        (p2 (* (lower-bound x) (upper-bound y)))
        (p3 (* (upper-bound x) (lower-bound y)))
        (p4 (* (upper-bound x) (upper-bound y))))
    (make-interval (min p1 p2 p3 p4)
                   (max p1 p2 p3 p4))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">mul-interval</span> x y)
  (<span style="color: #d1f1a9;">let</span> ((x0 (lower-bound x))
        (x1 (upper-bound x))
        (y0 (lower-bound y))
        (y1 (upper-bound y))
        (xs (state x))
        (ys (state y)))
    (<span style="color: #d1f1a9;">cond</span> ((<span style="color: #d1f1a9;">and</span> (&gt; xs 0) (&gt; ys 0))
           (make-interval (* x0 y0) (* x1 y1)))
          ((<span style="color: #d1f1a9;">and</span> (&gt; xs 0) (&lt; ys 0))
           (make-interval (* x1 y0) (* x0 y1)))
          ((<span style="color: #d1f1a9;">and</span> (&gt; xs 0) (= ys 0))
           (make-interval (* x1 y0) (* x1 y1)))
          ((<span style="color: #d1f1a9;">and</span> (&lt; xs 0) (&gt; ys 0))
           (make-interval (* x0 y1) (* x1 y0)))
          ((<span style="color: #d1f1a9;">and</span> (&lt; xs 0) (&lt; ys 0))
           (make-interval (* x1 y1) (* x0 y0)))
          ((<span style="color: #d1f1a9;">and</span> (&lt; xs 0) (= ys 0))
           (make-interval (* x1 y1) (* x0 y0)))
          ((<span style="color: #d1f1a9;">and</span> (= xs 0) (&gt; ys 0))
           (make-interval (* x0 y1) (* x1 y1)))
          ((<span style="color: #d1f1a9;">and</span> (= xs 0) (&lt; ys 0))
           (make-interval (* x1 y0) (* x0 y1)))
          ((<span style="color: #d1f1a9;">and</span> (= xs 0) (= ys 0))
           (make-interval (min (* x0 y1) (* x1 y0)) (max (* x0 y0) (* x1 y1)))))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">div-interval</span> x y)
  (<span style="color: #d1f1a9;">if</span> (not (= (state y) 0))
      (mul-interval x
                    (make-interval (/ 1.0 (upper-bound y))
                                   (/ 1.0 (lower-bound y))))
      (throw 'cross-zero <span style="color: #99ffff;">"Divided a cross-zero-interval!"</span>)))

<span style="color: #7285b7; font-style: italic;">#| Test |#</span>
(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">x1</span> (make-interval -1 3))
(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">x2</span> (make-interval -2 4))
(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">x3</span> (make-interval 2 4))
(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">x4</span> (make-center-percent 10 0.03))
(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">x5</span> (make-center-percent 5 0.001))
(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">x6</span> (make-interval 1000 1001))
(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">x7</span> (make-interval 2000 2005))


(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">show-bool</span> bool)
  (<span style="color: #d1f1a9;">if</span> bool <span style="color: #99ffff;">"true"</span>  <span style="color: #99ffff;">"false"</span>))

(list (add-interval x1 x2)
      (sub-interval x1 x2)
      (mul-interval x1 x2)
      (catch 'cross-zero
        (<span style="color: #d1f1a9;">lambda</span> () (div-interval x1 x2))
        (<span style="color: #d1f1a9;">lambda</span> (key arg) (display arg) <span style="color: #99ffff;">"NAN"</span>))
      (div-interval x1 x3)
      (show-bool (= (interval-width (add-interval x1 x2))
                    (+ (interval-width x1) (interval-width x2))))
      (show-bool (= (interval-width (sub-interval x1 x2))
                    (+ (interval-width x1) (interval-width x2))))
      (abs (- (interval-percent (mul-interval x1 x2)) (mul-interval-rough-percent x1 x2)))
      (abs (- (interval-percent (mul-interval x4 x5)) (mul-interval-rough-percent x4 x5)))
      (interval-percent x6)
      (interval-percent (add-interval x6 x6))
      (sub-interval x6 x6)
      (interval-percent (mul-interval x6 x6))
      (interval-percent (div-interval x6 x6))
      (interval-percent (div-interval x6 x7)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline48" class="outline-3">
<h3 id="orgheadline48"><span class="section-number-3">2.7</span> Exercise 2.17</h3>
<div class="outline-text-3" id="text-2-7">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">last-pair</span> list)
  (<span style="color: #d1f1a9;">let</span> ((tail (cdr list)))
    (<span style="color: #d1f1a9;">if</span> (null? tail)
        (car list)
        (last-pair tail))))

(last-pair (list 1 2 3 4))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline49" class="outline-3">
<h3 id="orgheadline49"><span class="section-number-3">2.8</span> Exercise 2.18</h3>
<div class="outline-text-3" id="text-2-8">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">reverse</span> li)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">reverse-iter</span> src dst)
    (<span style="color: #d1f1a9;">if</span> (null? src)
        dst
        (reverse-iter (cdr src) (cons (car src) dst))))
  (reverse-iter li (list)))

(reverse (list 1 2 3 4))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline50" class="outline-3">
<h3 id="orgheadline50"><span class="section-number-3">2.9</span> Exercise 2.19</h3>
<div class="outline-text-3" id="text-2-9">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">cc</span> amount coin-values)
  (<span style="color: #d1f1a9;">cond</span> ((= amount 0) 1)
        ((<span style="color: #d1f1a9;">or</span> (&lt; amount 0) (no-more? coin-values)) 0)
        (<span style="color: #d1f1a9;">else</span>
         (+ (cc amount
                (except-first-denomination coin-values))
            (cc (- amount (first-denomination coin-values)) coin-values)))))

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">no-more?</span> null?)

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">first-denomination</span> car)

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">except-first-denomination</span> cdr)

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">us-coins</span> (list 50 25 10 5 1))

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">uk-coins</span> (list 100 50 20 10 5 2 1 0.5))

(cc 100 us-coins)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline51" class="outline-3">
<h3 id="orgheadline51"><span class="section-number-3">2.10</span> Exercise 2.20</h3>
<div class="outline-text-3" id="text-2-10">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">identity</span> x) x)

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">same-parity</span> n . li)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">same-parity-iter</span> f li)
    (<span style="color: #d1f1a9;">if</span> (null? li)
        (f (list))
        (<span style="color: #d1f1a9;">if</span> (zero? (remainder (- (car li) n) 2))
            (same-parity-iter (<span style="color: #d1f1a9;">lambda</span> (x) (f (cons (car li) x))) (cdr li))
            (same-parity-iter f (cdr li)))))
  (cons n (same-parity-iter identity li)))

(list (same-parity 1 3 4 5 6 7 8)
      (same-parity 2 3 4 5 6 7 8))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline52" class="outline-3">
<h3 id="orgheadline52"><span class="section-number-3">2.11</span> Exercise 2.21</h3>
<div class="outline-text-3" id="text-2-11">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">map</span> li op)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">identity</span> x) x)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">map-cps-iter</span> src f)
    (<span style="color: #d1f1a9;">if</span> (null? src)
        (f (list))
        (map-cps-iter (cdr src)
                      (<span style="color: #d1f1a9;">lambda</span> (x)
                        (f (cons (op (car src)) x))))))
  (map-cps-iter li identity))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">square-list</span> x)
  (<span style="color: #d1f1a9;">map</span> x (<span style="color: #d1f1a9;">lambda</span> (x) (* x x))))

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">my-list</span> (list 1 2 3 4))

(square-list my-list)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline53" class="outline-3">
<h3 id="orgheadline53"><span class="section-number-3">2.12</span> Exercise 2.22</h3>
<div class="outline-text-3" id="text-2-12">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">square-list</span> items)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">iter</span> things answer)
    (<span style="color: #d1f1a9;">if</span> (null? things)
        answer
        (iter (cdr things)
              (cons answer
                    (square (car things))))))
  (iter items (list)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">square</span> x) (* x x))

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">my-list</span> (list 1 2 3 4))

(square-list my-list)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline54" class="outline-3">
<h3 id="orgheadline54"><span class="section-number-3">2.13</span> Exercise 2.23</h3>
<div class="outline-text-3" id="text-2-13">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">for-each</span> li op)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">for-each-iter</span> src)
    (<span style="color: #d1f1a9;">if</span> (not (null? src))
        (<span style="color: #d1f1a9;">begin</span>
          (op (car src))
          (for-each-iter (cdr src)))))
  (for-each-iter li))

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">my-list</span> (list 1 2 3 4))

(<span style="color: #d1f1a9;">for-each</span> my-list (<span style="color: #d1f1a9;">lambda</span> (x) (newline) (display x)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline55" class="outline-3">
<h3 id="orgheadline55"><span class="section-number-3">2.14</span> Exercise 2.24</h3>
<div class="outline-text-3" id="text-2-14">
<div class="org-src-container">

<pre class="src src-scheme">(list 1 (list 2 (list 3 4)))
<span style="color: #7285b7; font-style: italic;">#| (1 . (2 . (3 . 4))) |#</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline56" class="outline-3">
<h3 id="orgheadline56"><span class="section-number-3">2.15</span> Exercise 2.25</h3>
<div class="outline-text-3" id="text-2-15">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">l1</span> (list 1 3 (list 5 7) 9))
(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">l2</span> (list (list 7)))
(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">l3</span> (list 1 (list 2 (list 3 (list 4 (list 5 (list 6 7)))))))

(list
 (car (cdr (car (cdr (cdr l1)))))
 (car (car l2))
 (car (cdr (car (cdr (car (cdr (car (cdr (car (cdr (car (cdr l3)))))))))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline57" class="outline-3">
<h3 id="orgheadline57"><span class="section-number-3">2.16</span> Exercise 2.26</h3>
<div class="outline-text-3" id="text-2-16">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">x</span> (list 1 2 3))
(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">y</span> (list 4 5 6))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">append</span> list1 list2)
  (<span style="color: #d1f1a9;">if</span> (null? list1)
      list2
      (cons (car list1) (append (cdr list1) list2))))

(list
 (append x y) <span style="color: #7285b7; font-style: italic;">#|(1 2 3 4 5 6)|#</span>
 (cons x y) <span style="color: #7285b7; font-style: italic;">#|((1 2 3) 4 5 6)|#</span>
 (list x y) <span style="color: #7285b7; font-style: italic;">#|((1 2 3) (4 5 6))|#</span>
 )
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline58" class="outline-3">
<h3 id="orgheadline58"><span class="section-number-3">2.17</span> Exercise 2.27</h3>
<div class="outline-text-3" id="text-2-17">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">x</span> (list (list 1 2) (list 3 4)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">reverse</span> li)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">reverse-iter</span> src dst)
    (<span style="color: #d1f1a9;">if</span> (null? src)
        dst
        (reverse-iter (cdr src) (cons (car src) dst))))
  (reverse-iter li (list)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">deep-reverse</span> li)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">reverse-iter</span> src dst)
    (<span style="color: #d1f1a9;">if</span> (null? src)
        dst
        (<span style="color: #d1f1a9;">let</span> ((head
               (<span style="color: #d1f1a9;">if</span> (pair? (car src))
                   (reverse-iter (car src) (list))
                   (car src))))
          (reverse-iter (cdr src) (cons head dst)))))
  (reverse-iter li (list)))

(list (reverse x)
      (deep-reverse x))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline59" class="outline-3">
<h3 id="orgheadline59"><span class="section-number-3">2.18</span> Exercise 2.28</h3>
<div class="outline-text-3" id="text-2-18">
<div class="org-src-container">

<pre class="src src-scheme"> (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">leaf?</span> x)
   (<span style="color: #d1f1a9;">and</span> (pair? x)
        (not (pair? (car x)))))

 (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">wrap?</span> x)
   (<span style="color: #d1f1a9;">and</span> (pair? x)
        (null? (cdr x))
        (pair? (car x))))

 (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">append-cps</span> x y f)
   (<span style="color: #d1f1a9;">cond</span> ((null? x) (f y))
         ((not (pair? x)) (f (cons x y)))
         (<span style="color: #d1f1a9;">else</span> (append-cps (cdr x) y (<span style="color: #d1f1a9;">lambda</span> (r) (f (cons (car x) r)))))))

 (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">fringe</span> tree)
   (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">id</span> x) x)
   (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">fringe-iter</span> src f)
     (<span style="color: #d1f1a9;">cond</span> ((null? src) '())
           ((wrap? src) (fringe-iter (car src) f))
           ((leaf? src) (<span style="color: #d1f1a9;">if</span> (null? (cdr src))
                            (f (car src))
                            (fringe-iter (cdr src) (<span style="color: #d1f1a9;">lambda</span> (x) (f (cons (car src) x))))))
           (<span style="color: #d1f1a9;">else</span> (fringe-iter (car src) (<span style="color: #d1f1a9;">lambda</span> (x) (fringe-iter (cdr src)
                                                                 (<span style="color: #d1f1a9;">lambda</span> (y) (append-cps x y f))))))))
   (fringe-iter tree (<span style="color: #d1f1a9;">lambda</span> (x) (append-cps x '() id))))

 (<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">x</span> (list (list 1 2) (list 3 4)))

(fringe (list x x))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline60" class="outline-3">
<h3 id="orgheadline60"><span class="section-number-3">2.19</span> Exercise 2.29</h3>
<div class="outline-text-3" id="text-2-19">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">make-mobile</span> left right)
  (list left right))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">make-branch</span> length structure)
  (list length structure))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">left-branch</span> mobile)
  (car mobile))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">right-branch</span> mobile)
  (car (cdr mobile)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">branch-length</span> branch)
  (car branch))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">branch-structure</span> branch)
  (car (cdr branch)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">mobile?</span> x)
  (<span style="color: #d1f1a9;">and</span> (pair? x)
       (branch? (left-branch x))
       (branch? (right-branch x))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">branch?</span> x)
  (<span style="color: #d1f1a9;">and</span> (pair? x)
       (not (pair? (car x)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">total-weight</span> mobile)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">id</span> x) x)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">total-weight-cps</span> x f)
    (<span style="color: #d1f1a9;">if</span> (mobile? x)
        (<span style="color: #d1f1a9;">let</span> ((ll (branch-length (left-branch x)))
              (rl (branch-length (right-branch x)))
              (ls (branch-structure (left-branch x)))
              (rs (branch-structure (right-branch x))))
          (total-weight-cps ls
                            (<span style="color: #d1f1a9;">lambda</span> (lw) (total-weight-cps rs
                                                           (<span style="color: #d1f1a9;">lambda</span> (rw) (f (+ lw rw)))))))
        (f x)))
  (total-weight-cps mobile id))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">torque</span> x)
  (<span style="color: #d1f1a9;">if</span> (branch? x)
      (<span style="color: #d1f1a9;">let</span> ((bl (branch-length x))
            (bs (branch-structure x)))
        (* bl (total-weight bs)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">is-balence?</span> mobile)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">id</span> x) x)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">is-balence?-cps</span> x f)
    (<span style="color: #d1f1a9;">if</span> (mobile? x)
        (<span style="color: #d1f1a9;">let</span> ((l (left-branch x))
              (r (right-branch x))
              (ll (branch-length (left-branch x)))
              (rl (branch-length (right-branch x)))
              (ls (branch-structure (left-branch x)))
              (rs (branch-structure (right-branch x))))
          (<span style="color: #d1f1a9;">if</span> (eq? (torque l) (torque r))
              (is-balence?-cps ls
                               (<span style="color: #d1f1a9;">lambda</span> (lb) (is-balence?-cps rs
                                                             (<span style="color: #d1f1a9;">lambda</span> (rb) (f (<span style="color: #d1f1a9;">and</span> lb rb))))))
              (f #f)))
        (f #t)))
  (is-balence?-cps mobile id))
<span style="color: #7285b7; font-style: italic;">#|Test|#</span>

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">m1</span> (make-mobile (make-branch 10 100)
                        (make-branch 5 200)))

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">m2</span> (make-mobile (make-branch 3 100)
                        (make-branch 4 50)))

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">m</span> (make-mobile (make-branch 4 m1)
                       (make-branch 8 m2)))

(list
 (total-weight m1)
 (total-weight m2)
 (total-weight m)
 (is-balence? m1)
 (is-balence? m2)
 (is-balence? m))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline61" class="outline-3">
<h3 id="orgheadline61"><span class="section-number-3">2.20</span> Exercise 2.30, 2.31</h3>
<div class="outline-text-3" id="text-2-20">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">recursive-map-tree</span> tree op)
  (<span style="color: #d1f1a9;">cond</span> ((null? tree) '())
        ((not (pair? tree)) (op tree))
        (<span style="color: #d1f1a9;">else</span> (cons (recursive-map-tree (car tree) op)
                    (recursive-map-tree (cdr tree) op)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">iterative-map-tree</span> tree op)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">id</span> x) x)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">map-tree-cps</span> x f)
    (<span style="color: #d1f1a9;">cond</span> ((null? x) (f '()))
          ((not (pair? x)) (f (op x)))
          (<span style="color: #d1f1a9;">else</span> (map-tree-cps (car x)
                              (<span style="color: #d1f1a9;">lambda</span> (lt) (map-tree-cps (cdr x)
                                                         (<span style="color: #d1f1a9;">lambda</span> (rt) (f (cons lt rt)))))))))
  (map-tree-cps tree id))
<span style="color: #7285b7; font-style: italic;">#|Test|#</span>
(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">t</span> (list 1 (list 2 (list 3 4) 5) (list 6 7)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">op</span> x)
  (* x x))

(list t
      (recursive-map-tree t op)
      (iterative-map-tree t op))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline62" class="outline-3">
<h3 id="orgheadline62"><span class="section-number-3">2.21</span> Exercise 2.32</h3>
<div class="outline-text-3" id="text-2-21">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">iterative-map-list</span> li op)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">id</span> x) x)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">map-list-cps</span> x f)
    (<span style="color: #d1f1a9;">if</span> (null? x)
        (f '())
        (map-list-cps (cdr x)
                      (<span style="color: #d1f1a9;">lambda</span> (l)
                        (cons (op (car x)) l)))))
  (map-list-cps li id))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">subsets</span> s)
  (<span style="color: #d1f1a9;">if</span> (null? s)
      (list s)
      (<span style="color: #d1f1a9;">let</span> ((rest (subsets (cdr s))))
        (append rest (iterative-map-list rest (<span style="color: #d1f1a9;">lambda</span> (x) (cons (car s) x)))))))
<span style="color: #7285b7; font-style: italic;">#|Test|#</span>
(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">s</span> (list 1 2 3 (list 4 5) 6 7))

(subsets s)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline63" class="outline-3">
<h3 id="orgheadline63"><span class="section-number-3">2.22</span> Exercise 2.33, 2.34</h3>
<div class="outline-text-3" id="text-2-22">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">accumulate</span> op initial sequence)
  (<span style="color: #d1f1a9;">if</span> (null? sequence)
      initial
      (op (car sequence)
          (accumulate op initial (cdr sequence)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">map</span> p sequence)
  (accumulate (<span style="color: #d1f1a9;">lambda</span> (x y) (cons (p x) y)) '() sequence))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">append</span> seq1 seq2)
  (accumulate cons seq2 seq1))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">length</span> sequence)
  (accumulate (<span style="color: #d1f1a9;">lambda</span> (x y) (+ y 1)) 0 sequence))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">horner-eval</span> x coefficient-sequence)
  (accumulate (<span style="color: #d1f1a9;">lambda</span> (this-coeff higher-terms)
                (+ this-coeff (* x higher-terms)))
              0
              coefficient-sequence))
<span style="color: #7285b7; font-style: italic;">#|Test|#</span>

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">l1</span> (list 1 2 3 4 5))

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">l2</span> (list 6 7 8))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">f</span> x) (+ x 1))

(list (<span style="color: #d1f1a9;">map</span> f l1)
      (append l1 l2)
      (length l1)
      (horner-eval 0 (list 2 2 2))
      (horner-eval 2 (list 2 2 2)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline64" class="outline-3">
<h3 id="orgheadline64"><span class="section-number-3">2.23</span> Exercise 2.35</h3>
<div class="outline-text-3" id="text-2-23">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">accumulate</span> op initial sequence)
  (<span style="color: #d1f1a9;">if</span> (null? sequence)
      initial
      (op (car sequence)
          (accumulate op initial (cdr sequence)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">count-leaves</span> t)
  (accumulate (<span style="color: #d1f1a9;">lambda</span> (z x) (+ z x))
              0
              (<span style="color: #d1f1a9;">map</span> (<span style="color: #d1f1a9;">lambda</span> (x)
                       (<span style="color: #d1f1a9;">cond</span> ((null? x) '())
                             ((pair? x) (count-leaves x))
                             (<span style="color: #d1f1a9;">else</span> 1))) t)))

<span style="color: #7285b7; font-style: italic;">#|Test|#</span>
(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">t</span> (list (list 1 2) 3 4 (list 5 6) 7))

(count-leaves t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline65" class="outline-3">
<h3 id="orgheadline65"><span class="section-number-3">2.24</span> Exercise 2.36</h3>
<div class="outline-text-3" id="text-2-24">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">accumulate</span> op initial sequence)
  (<span style="color: #d1f1a9;">if</span> (null? sequence)
      initial
      (op (car sequence)
          (accumulate op initial (cdr sequence)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">seqs-split</span> seqs)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">li-id</span> x y) (cons x y))
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">seqs-split-cps</span> seqs f)
    (<span style="color: #d1f1a9;">if</span> (null? seqs)
        (f '() '())
        (seqs-split-cps (cdr seqs)
                        (<span style="color: #d1f1a9;">lambda</span> (x y)
                          (f (cons (car (car seqs)) x)
                             (cons (cdr (car seqs)) y))))))
  (seqs-split-cps seqs li-id))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">accumulate-n</span> op init seqs)
  (<span style="color: #d1f1a9;">if</span> (null? (car seqs))
      '()
      (<span style="color: #d1f1a9;">let</span> ((split-seqs (seqs-split seqs)))
        (cons (accumulate op init (car split-seqs))
              (accumulate-n op init (cdr split-seqs))))))

<span style="color: #7285b7; font-style: italic;">#|Test|#</span>
(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">li</span> (list (list 1 2 3 4)
                 (list 3 4 5 6)
                 (list 5 6 7 8)))

(accumulate-n (<span style="color: #d1f1a9;">lambda</span> (z x)
                (+ z x))
              0
              li)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline66" class="outline-3">
<h3 id="orgheadline66"><span class="section-number-3">2.25</span> Exercise 2.37</h3>
<div class="outline-text-3" id="text-2-25">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">accumulate</span> op initial sequence)
  (<span style="color: #d1f1a9;">if</span> (null? sequence)
      initial
      (op (car sequence)
          (accumulate op initial (cdr sequence)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">seqs-split</span> seqs)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">li-id</span> x y) (cons x y))
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">seqs-split-cps</span> seqs f)
    (<span style="color: #d1f1a9;">if</span> (null? seqs)
        (f '() '())
        (seqs-split-cps (cdr seqs)
                        (<span style="color: #d1f1a9;">lambda</span> (x y)
                          (f (cons (car (car seqs)) x)
                             (cons (cdr (car seqs)) y))))))
  (seqs-split-cps seqs li-id))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">accumulate-n</span> op init seqs)
  (<span style="color: #d1f1a9;">if</span> (null? (car seqs))
      '()
      (<span style="color: #d1f1a9;">let</span> ((split-seqs (seqs-split seqs)))
        (cons (accumulate op init (car split-seqs))
              (accumulate-n op init (cdr split-seqs))))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">dot-product</span> v w)
  (accumulate + 0 (<span style="color: #d1f1a9;">map</span> * v w)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">matrix-*-vector</span> m v)
  (<span style="color: #d1f1a9;">map</span> (<span style="color: #d1f1a9;">lambda</span> (w)
         (dot-product w v)) m))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">transpose</span> mat)
  (accumulate-n cons '() mat))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">matrix-*-matrix</span> m n)
  (<span style="color: #d1f1a9;">let</span> ((cols (transpose n)))
    (<span style="color: #d1f1a9;">map</span> (<span style="color: #d1f1a9;">lambda</span> (x)
           (matrix-*-vector cols x))
         m)))
<span style="color: #7285b7; font-style: italic;">#|Test|#</span>
(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">v</span> (list 1 2 3 4))

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">w</span> (list 2 4 6 8))

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">n</span> (list (list 2 2) (list 3 3) (list 4 4) (list 5 5)))

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">m</span> (list (list 1 1 1 1) w))

(list (dot-product v w)
      (matrix-*-vector m v)
      (transpose m)
      (matrix-*-matrix m n))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline67" class="outline-3">
<h3 id="orgheadline67"><span class="section-number-3">2.26</span> Exercise 2.38</h3>
<div class="outline-text-3" id="text-2-26">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">fold-right</span> op initial sequence)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">id</span> x) x)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">fold-right-cps</span> seq f)
    (<span style="color: #d1f1a9;">if</span> (null? seq)
        (f initial)
        (fold-right-cps (cdr seq)
                        (<span style="color: #d1f1a9;">lambda</span> (x)
                          (f (op x (car seq)))))))
  (fold-right-cps sequence id))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">fold-left</span> op initial sequence)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">id</span> x) x)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">fold-left-cps</span> seq r f)
    (<span style="color: #d1f1a9;">if</span> (null? seq)
        (f r)
        (fold-left-cps (cdr seq)
                       (op r (car seq))
                       f)))
  (fold-left-cps sequence initial id))

<span style="color: #7285b7; font-style: italic;">#|Test|#</span>
(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">seq</span> (list 1 2 3 4))

(list (fold-right (<span style="color: #d1f1a9;">lambda</span> (z x)
                    (+ x (* 2 z))) 0 seq)
      (fold-left (<span style="color: #d1f1a9;">lambda</span> (z x)
                   (+ x (* 2 z))) 0 seq))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline68" class="outline-3">
<h3 id="orgheadline68"><span class="section-number-3">2.27</span> Exercise 2.39</h3>
<div class="outline-text-3" id="text-2-27">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">fold-right</span> op initial sequence)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">id</span> x) x)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">fold-right-cps</span> seq f)
    (<span style="color: #d1f1a9;">if</span> (null? seq)
        (f initial)
        (fold-right-cps (cdr seq)
                        (<span style="color: #d1f1a9;">lambda</span> (x)
                          (f (op x (car seq)))))))
  (fold-right-cps sequence id))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">fold-left</span> op initial sequence)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">id</span> x) x)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">fold-left-cps</span> seq r f)
    (<span style="color: #d1f1a9;">if</span> (null? seq)
        (f r)
        (fold-left-cps (cdr seq)
                       (op r (car seq))
                       f)))
  (fold-left-cps sequence initial id))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">reverse-right</span> sequence)
  (fold-right (<span style="color: #d1f1a9;">lambda</span> (z x)
                (append z (list x)))
              '()
              sequence))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">reverse-left</span> sequence)
  (fold-left (<span style="color: #d1f1a9;">lambda</span> (z x)
               (cons x z))
             '()
             sequence))

<span style="color: #7285b7; font-style: italic;">#|Test|#</span>
(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">li</span> (list 1 2 3 4))

(list (reverse-right li)
      (reverse-left li))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline69" class="outline-3">
<h3 id="orgheadline69"><span class="section-number-3">2.28</span> Exercise 2.40</h3>
<div class="outline-text-3" id="text-2-28">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">accumulate</span> op initial sequence)
  (<span style="color: #d1f1a9;">if</span> (null? sequence)
      initial
      (op (car sequence)
          (accumulate op initial (cdr sequence)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">flatmap</span> proc seq)
  (accumulate append '() (<span style="color: #d1f1a9;">map</span> proc seq)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">enumerate-interval</span> x y)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">id</span> x) x)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">enumerate-interval-cps</span> x f)
    (<span style="color: #d1f1a9;">if</span> (&gt; x y)
        (f '())
        (enumerate-interval-cps (+ x 1)
                                (<span style="color: #d1f1a9;">lambda</span> (s)
                                  (f (cons x s))))))
  (enumerate-interval-cps x id))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">unique-pairs</span> n)
  (flatmap (<span style="color: #d1f1a9;">lambda</span> (x)
             (<span style="color: #d1f1a9;">map</span> (<span style="color: #d1f1a9;">lambda</span> (y)
                    (list y x))
                  (enumerate-interval 1 (- x 1))))
           (enumerate-interval 1 n)))

<span style="color: #7285b7; font-style: italic;">#|Test|#</span>
(unique-pairs 5)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline70" class="outline-3">
<h3 id="orgheadline70"><span class="section-number-3">2.29</span> Exercise 2.41</h3>
<div class="outline-text-3" id="text-2-29">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">accumulate</span> op initial sequence)
  (<span style="color: #d1f1a9;">if</span> (null? sequence)
      initial
      (op (car sequence)
          (accumulate op initial (cdr sequence)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">flatmap</span> proc seq)
  (accumulate append '() (<span style="color: #d1f1a9;">map</span> proc seq)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">enumerate-interval</span> x y)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">id</span> x) x)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">enumerate-interval-cps</span> x f)
    (<span style="color: #d1f1a9;">if</span> (&gt; x y)
        (f '())
        (enumerate-interval-cps (+ x 1)
                                (<span style="color: #d1f1a9;">lambda</span> (s)
                                  (f (cons x s))))))
  (enumerate-interval-cps x id))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">filter</span> predicate seq)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">id</span> x) x)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">filter-cps</span> seq f)
    (<span style="color: #d1f1a9;">if</span> (null? seq)
        (f '())
        (<span style="color: #d1f1a9;">if</span> (predicate (car seq))
            (filter-cps (cdr seq) (<span style="color: #d1f1a9;">lambda</span> (x)
                                    (f (cons (car seq) x))))
            (filter-cps (cdr seq) f))))
  (filter-cps seq id))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">tri-sum</span> s n)
  (flatmap (<span style="color: #d1f1a9;">lambda</span> (a)
             (<span style="color: #d1f1a9;">map</span> (<span style="color: #d1f1a9;">lambda</span> (b)
                    (list a b (- s a b)))
                  (filter (<span style="color: #d1f1a9;">lambda</span> (x)
                            (<span style="color: #d1f1a9;">and</span> (not (= x a))
                                 (not (= (* 2 x) (- s a)))))
                   (enumerate-interval (max 1 (- n a)) (min n (- s a))))))
           (enumerate-interval 1 (min n s))))

<span style="color: #7285b7; font-style: italic;">#|Test|#</span>
(tri-sum 8 5)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline71" class="outline-3">
<h3 id="orgheadline71"><span class="section-number-3">2.30</span> Exercise 2.42</h3>
<div class="outline-text-3" id="text-2-30">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">accumulate</span> op initial sequence)
  (<span style="color: #d1f1a9;">if</span> (null? sequence)
      initial
      (op (car sequence)
          (accumulate op initial (cdr sequence)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">flatmap</span> proc seq)
  (accumulate append '() (<span style="color: #d1f1a9;">map</span> proc seq)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">enumerate-interval</span> x y)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">id</span> x) x)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">enumerate-interval-cps</span> x f)
    (<span style="color: #d1f1a9;">if</span> (&gt; x y)
        (f '())
        (enumerate-interval-cps (+ x 1)
                                (<span style="color: #d1f1a9;">lambda</span> (s)
                                  (f (cons x s))))))
  (enumerate-interval-cps x id))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">filter</span> predicate seq)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">id</span> x) x)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">filter-cps</span> seq f)
    (<span style="color: #d1f1a9;">if</span> (null? seq)
        (f '())
        (<span style="color: #d1f1a9;">if</span> (predicate (car seq))
            (filter-cps (cdr seq) (<span style="color: #d1f1a9;">lambda</span> (x)
                                    (f (cons (car seq) x))))
            (filter-cps (cdr seq) f))))
  (filter-cps seq id))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">adjoin-position</span> new k rest)
  (append rest (list new)))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">list-get</span> li n)
  (<span style="color: #d1f1a9;">if</span> (= n 0)
      (car li)
      (list-get (cdr li) (- n 1))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">safe?</span> k positions)
  (accumulate (<span style="color: #d1f1a9;">lambda</span> (x y)
                (<span style="color: #d1f1a9;">and</span> x y))
              #t
              (<span style="color: #d1f1a9;">map</span> (<span style="color: #d1f1a9;">lambda</span> (i)
                     (<span style="color: #d1f1a9;">let</span> ((x (list-get positions (- k 1)))
                           (y (list-get positions (- i 1))))
                       (<span style="color: #d1f1a9;">and</span> (not (= x y))
                            (not (= x (+ y (- k i))))
                            (not (= x (- y (- k i)))))))
                   (enumerate-interval 1 (- k 1)))))

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">queens</span> board-size)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">queen-cols</span> k)
    (<span style="color: #d1f1a9;">if</span> (= k 1) (<span style="color: #d1f1a9;">map</span> list (enumerate-interval 1 board-size))
        (filter (<span style="color: #d1f1a9;">lambda</span> (positions) (safe? k positions))
                (flatmap (<span style="color: #d1f1a9;">lambda</span> (rest-of-queens)
                           (<span style="color: #d1f1a9;">map</span> (<span style="color: #d1f1a9;">lambda</span> (new-row)
                                  (adjoin-position new-row k rest-of-queens))
                                (enumerate-interval 1 board-size)))
                         (queen-cols (- k 1))))))
  (queen-cols board-size))

(queens 4)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline72" class="outline-3">
<h3 id="orgheadline72"><span class="section-number-3">2.31</span> Exercise 2.42</h3>
<div class="outline-text-3" id="text-2-31">
<p>
T<sup>2</sup><br  />
</p>
</div>
</div>

<div id="outline-container-orgheadline73" class="outline-3">
<h3 id="orgheadline73"><span class="section-number-3">2.32</span> Exercise 2.53</h3>
<div class="outline-text-3" id="text-2-32">
<div class="org-src-container">

<pre class="src src-scheme">(list
 (list 'a 'b 'c) <span style="color: #7285b7; font-style: italic;">; </span><span style="color: #7285b7; font-style: italic;">(a b c)</span>
 (list (list 'george)) <span style="color: #7285b7; font-style: italic;">; </span><span style="color: #7285b7; font-style: italic;">((george))</span>
 (cdr '((x1 x2) (y1 y2))) <span style="color: #7285b7; font-style: italic;">; </span><span style="color: #7285b7; font-style: italic;">((y1 y2))</span>
 (car '((x1 x2) (y1 y2))) <span style="color: #7285b7; font-style: italic;">; </span><span style="color: #7285b7; font-style: italic;">(x1 x2)</span>
 (pair? (car '(a short list))) <span style="color: #7285b7; font-style: italic;">; </span><span style="color: #7285b7; font-style: italic;">#f</span>
 (memq 'red '((red shoes) (blue socks))) <span style="color: #7285b7; font-style: italic;">; </span><span style="color: #7285b7; font-style: italic;">#f</span>
 (memq 'red '(shoes red blue socks)) <span style="color: #7285b7; font-style: italic;">; </span><span style="color: #7285b7; font-style: italic;"># (red blue socks)</span>
 )
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline74" class="outline-3">
<h3 id="orgheadline74"><span class="section-number-3">2.33</span> Exercise 2.54</h3>
<div class="outline-text-3" id="text-2-33">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">equal?</span> s1 s2)
  (<span style="color: #d1f1a9;">if</span> (<span style="color: #d1f1a9;">and</span> (pair? s1) (pair? s2)) <span style="color: #7285b7; font-style: italic;">; </span><span style="color: #7285b7; font-style: italic;">if they are all pairs</span>
      (<span style="color: #d1f1a9;">and</span> (eq? (car s1) (car s2)) (equal? (cdr s1) (cdr s2)))
      (eq? s1 s2)))

<span style="color: #7285b7; font-style: italic;">;; </span><span style="color: #7285b7; font-style: italic;">Test</span>
(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">li1</span> '(this is a list))

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">li2</span> '(this (is a) list))

(list (equal? li1 li1)
      (equal? li1 li2))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline75" class="outline-3">
<h3 id="orgheadline75"><span class="section-number-3">2.34</span> Exercise 2.55</h3>
<div class="outline-text-3" id="text-2-34">
<div class="org-src-container">

<pre class="src src-scheme">(car ''abracadabra)
(car (quote (quote abracadabra)))
(car (list 'quote 'abracadabra))
'quote
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline76" class="outline-3">
<h3 id="orgheadline76"><span class="section-number-3">2.35</span> Exercise 3.1</h3>
<div class="outline-text-3" id="text-2-35">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">make-accumulator</span> init)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">accumulator</span> increment)
    (set! init (+ init increment))
    init)
  accumulator)

<span style="color: #7285b7; font-style: italic;">;; </span><span style="color: #7285b7; font-style: italic;">Test</span>
(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">A</span> (make-accumulator 5))
(list (A 10)
      (A 10))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline77" class="outline-3">
<h3 id="orgheadline77"><span class="section-number-3">2.36</span> Exercise 3.2</h3>
<div class="outline-text-3" id="text-2-36">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">make-monitored</span> f)
  (<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">call-count</span> 0)
  (<span style="color: #d1f1a9;">lambda</span> (x)
    (<span style="color: #d1f1a9;">cond</span> ((eq? x 'how-many-calls?)
           call-count)
          ((eq? x 'reset-count)
           (<span style="color: #d1f1a9;">begin</span> (set! call-count 0)
                  call-count))
          (<span style="color: #d1f1a9;">else</span> (<span style="color: #d1f1a9;">begin</span>
                  (set! call-count (+ call-count 1))
                  (f x))))))

<span style="color: #7285b7; font-style: italic;">;; </span><span style="color: #7285b7; font-style: italic;">Test</span>
(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">s</span> (make-monitored sqrt))

(list (s 100)
      (s 81)
      (s 'how-many-calls?)
      (s 'reset-count)
      (s 25)
      (s 'how-many-calls?))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline78" class="outline-3">
<h3 id="orgheadline78"><span class="section-number-3">2.37</span> Exercise 3.3, 3.4</h3>
<div class="outline-text-3" id="text-2-37">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">call-the-cops</span> amount)
  <span style="color: #99ffff;">"Already called cops"</span>)

(<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">make-account</span> balance pwd)
  (<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">psw-wrong-times</span> 0)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">withdraw</span> amount)
    (<span style="color: #d1f1a9;">if</span> (&gt;= balance amount)
        (<span style="color: #d1f1a9;">begin</span> (set! balance (- balance amount))
               balance)
        <span style="color: #99ffff;">"Insufficient funds"</span>))
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">deposit</span> amount)
    (set! balance (+ balance amount))
    balance)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">complain</span> amount)
    <span style="color: #99ffff;">"!"</span>)
  (<span style="color: #d1f1a9;">define</span> (<span style="color: #ffc58f;">dispatch</span> p m)
    (<span style="color: #d1f1a9;">if</span> (not (eq? pwd p))
        (<span style="color: #d1f1a9;">begin</span>
          (set! psw-wrong-times (+ psw-wrong-times 1))
          (<span style="color: #d1f1a9;">if</span> (&gt;= psw-wrong-times 7)
              call-the-cops
              complain))
        (<span style="color: #d1f1a9;">begin</span>
          (set! psw-wrong-times 0)
          (<span style="color: #d1f1a9;">cond</span> ((eq? m 'withdraw) withdraw)
                ((eq? m 'deposit) deposit)
                (<span style="color: #d1f1a9;">else</span> (error <span style="color: #99ffff;">"Unknown request -- MAKE-ACOUNT"</span> m))))))
  dispatch)

<span style="color: #7285b7; font-style: italic;">;; </span><span style="color: #7285b7; font-style: italic;">Test</span>

(<span style="color: #d1f1a9;">define</span> <span style="color: #ffc58f;">acc</span> (make-account 100 'secret-password))

(list
 ((acc 'secret-password 'withdraw) 50)
 ((acc 'secret-password 'withdraw) 60)
 ((acc 'secret-password 'deposit) 40)
 ((acc 'wrong-password 'deposit) 40)
 ((acc 'wrong-password 'deposit) 40)
 ((acc 'wrong-password 'deposit) 40)
 ((acc 'wrong-password 'deposit) 40)
 ((acc 'wrong-password 'deposit) 40)
 ((acc 'wrong-password 'deposit) 40)
 ((acc 'secret-password 'withdraw) 60)
 ((acc 'wrong-password 'deposit) 40)
 ((acc 'wrong-password 'deposit) 40)
 ((acc 'wrong-password 'deposit) 40)
 ((acc 'wrong-password 'deposit) 40)
 ((acc 'wrong-password 'deposit) 40)
 ((acc 'wrong-password 'deposit) 40)
 ((acc 'wrong-password 'deposit) 40))
</pre>
</div>
</div>
</div>
</div>
